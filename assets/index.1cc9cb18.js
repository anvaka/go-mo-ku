const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};B();var z=function(t){W(t);var e=U(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t};function U(t){var e=Object.create(null);return{on:function(n,i,r){if(typeof i!="function")throw new Error("callback is expected to be a function");var o=e[n];return o||(o=e[n]=[]),o.push({callback:i,ctx:r}),t},off:function(n,i){var r=typeof n=="undefined";if(r)return e=Object.create(null),t;if(e[n]){var o=typeof i!="function";if(o)delete e[n];else for(var s=e[n],h=0;h<s.length;++h)s[h].callback===i&&s.splice(h,1)}return t},fire:function(n){var i=e[n];if(!i)return t;var r;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var s=i[o];s.callback.apply(s.ctx,r)}return t}}}function W(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}var D=F;function F(t){var e=[],n=t;return{dispose:o,onChanged:s,set:r,get:i};function i(){return n}function r(d){n=d,setTimeout(function(){h(d)},0)}function o(){e=[]}function s(d){if(typeof d!="function")throw new Error("changeCallback should be a function");e.push(d)}function h(d){e.forEach(function(u){u(d)})}}var R={parse:j,stringify:$};function $(t){if(!t)return"";return Object.keys(t).map(e).join("&");function e(n){var i=t[n],r=O(n);return i!==void 0&&(r+="="+_(i)),r}}function j(t){var e=Object.create(null);if(!t)return e;return t.split("&").forEach(n),e;function n(i){if(!!i){var r=i.split("=");e[decodeURIComponent(r[0])]=Q(r[1])}}}function _(t){t instanceof Date&&(t=t.toISOString());var e=O(t);return e}function O(t){var e=encodeURIComponent(t);return e.replace(/[()]/g,K)}function K(t){return t===")"?"%29":t==="("?"%28":t}function Q(t){return t=decodeURIComponent(t),t===""?t:isNaN(t)?V(t)?t==="true":X(t)?new Date(t):t:parseFloat(t)}function V(t){return t==="true"||t==="false"}function X(t){return t&&t.match(/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/)}var Y=Z,G=D,w=R;function Z(t,e){if(typeof window=="undefined")return G(t);var n=[],i=e&&e.useSearch,r=i?"?":"#?";return e.rewriteHashToSearch&&s(),o(),{onChanged:d,dispose:u,set:h,get:g,rewriteHashToSearch:s};function o(){var a=g(),c=!1;typeof t=="object"&&t&&Object.keys(t).forEach(function(l){l in a||(a[l]=t[l],c=!0)}),c&&h(a)}function s(){var a=Object.create(null),c=window.location.search;c&&(a=Object.assign(a,w.parse(c.substr(1))));var l=window.location.hash;l&&(a=Object.assign(a,w.parse(l.substr(2)))),h(a)}function h(a){var c=r+w.stringify(a);i&&window.location.hash&&(c+=window.location.hash),window.history?window.history.replaceState(void 0,void 0,c):window.location.replace(c)}function d(a){if(typeof a!="function")throw new Error("changeCallback needs to be a function");n.length===0&&window.addEventListener("hashchange",f,!1),n.push(a)}function u(){n.length!==0&&(n=[],window.removeEventListener("hashchange",f,!1))}function f(){var a=g();y(a)}function y(a){for(var c=0;c<n.length;++c){var l=n[c];l(a)}}function g(){var a=i?window.location.search:window.location.hash,c=(a||r).substr(r.length);return w.parse(c)}}var L=k,J=z,N=Y;k.instance=ee;var C;function k(t,e){e=e||{};var n=e.history||N(t,e);te(n),n.onChanged(a);var i=n.get()||Object.create(null),r={get:f,set:y,unset:g,setIfEmpty:c,dispose:u,onChange:s,offChange:h,getHistoryObject:d},o=J({});return r;function s(l,p){o.on("change",l,p)}function h(l,p){o.off("change",l,p)}function d(){return n}function u(){n.dispose(),o.off()}function f(l){return l===void 0?i:i[l]}function y(l,p){var v=typeof l;return v==="object"?Object.keys(l).forEach(function(I){i[I]=l[I]}):v==="string"&&(i[l]=p),n.set(i),r}function g(l){if(l in i)return delete i[l],n.set(i),r}function a(l){i=l,o.fire("change",i)}function c(l,p){if(typeof l=="object"&&Object.keys(l).forEach(function(v){v in i||(i[v]=l[v])}),!(l in i))return i[l]=p,n.set(i),r}}function ee(t,e){return C?t&&C.setIfEmpty(t):C=k(t,e),C}function te(t){if(!t)throw new Error("history is required");if(typeof t.dispose!="function")throw new Error("dispose is required");if(typeof t.onChanged!="function")throw new Error("onChanged is required")}function b(t,e,n){return Math.min(Math.max(t,e),n)}class ne{constructor(e,n,i){this.container=e,this.board=n,this.cellSize=i;const r=document.createElement("div");r.className="cursor",r.style.position="absolute",r.style.width=i-1+"px",r.style.height=i-1+"px",e.appendChild(r),this.cursor=r,this.renderAt(0,0)}renderAt(e,n,i=!1){e=b(e,0,this.board.width-1),n=b(n,0,this.board.height-1),this.lastX=e,this.lastY=n,this.cursor.style.left=e*this.cellSize+1+"px",this.cursor.style.top=n*this.cellSize+1+"px",i&&this.cursor.scrollIntoView()}}class ie{constructor(e,n,i){this.onMouseMove=this.onMouseMove.bind(this),this.onClick=this.onClick.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.container=e,this.board=n,this.gameCursor=new ne(e,n,i),this.cellUISize=i,this.listenToEvents()}listenToEvents(){this.container.addEventListener("mousemove",this.onMouseMove),this.container.addEventListener("click",this.onClick),this.container.addEventListener("keydown",this.onKeyDown)}dispose(){this.container.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("click",this.onClick),this.container.removeEventListener("keydown",this.onKeyDown)}onKeyDown(e){e.metaKey||e.ctrlKey||(e.keyCode===32||e.keyCode===13?(this.board.play(this.gameCursor.lastX,this.gameCursor.lastY),e.preventDefault()):e.keyCode===37||e.keyCode===65||e.keyCode===72?(this.gameCursor.renderAt(this.gameCursor.lastX-1,this.gameCursor.lastY,!0),e.preventDefault()):e.keyCode===38||e.keyCode===87||e.keyCode===75?(this.gameCursor.renderAt(this.gameCursor.lastX,this.gameCursor.lastY-1,!0),e.preventDefault()):e.keyCode===39||e.keyCode===68||e.keyCode===76?(this.gameCursor.renderAt(this.gameCursor.lastX+1,this.gameCursor.lastY,!0),e.preventDefault()):e.keyCode===40||e.keyCode===83||e.keyCode===74?(this.gameCursor.renderAt(this.gameCursor.lastX,this.gameCursor.lastY+1,!0),e.preventDefault()):e.keyCode===48?(this.gameCursor.renderAt(0,this.gameCursor.lastY,!0),e.preventDefault()):e.keyCode===52&&(this.gameCursor.renderAt(this.board.width-1,this.gameCursor.lastY,!0),e.preventDefault()))}onMouseMove(e){const n=this.getCellPosition(e);this.gameCursor.renderAt(n.x,n.y)}onClick(e){e.preventDefault();const n=this.getCellPosition(e);this.board.play(n.x,n.y)}getCellPosition(e){const n=e.target.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;return{x:b(Math.floor(i/this.cellUISize),0,this.board.width-1),y:b(Math.floor(r/this.cellUISize),0,this.board.height-1)}}}class A{constructor(e,n){this.container=e,this.board=n,this.cellUISize=Math.min(42,Math.max(36,window.innerWidth/n.width)),this.renderedPositions=new Map,this.inputHandler=new ie(e,n,this.cellUISize),this.listenToEvents(),this.renderBackgroundGrid(),this.renderPositions(),this.showLastMove()}listenToEvents(){this.board.on("play",this.renderPositions,this),this.board.on("remove",this.removePosition,this),this.board.on("clear",this.clear,this),this.board.on("winLengthChanged",this.renderPositions,this)}dispose(){this.container.innerText="",this.board.off("play",this.renderPositions),this.board.off("remove",this.removePosition),this.board.off("clear",this.clear),this.board.off("winLengthChanged",this.renderPositions,this),this.inputHandler.dispose()}showLastMove(){const e=document.querySelector(".last-move");e&&e.scrollIntoView()}focus(){this.container.focus()}renderBackgroundGrid(){this.container.style.width=1+this.board.width*this.cellUISize+"px",this.container.style.height=1+this.board.height*this.cellUISize+"px",this.container.style.backgroundSize=this.cellUISize+"px "+this.cellUISize+"px"}clear(){this.renderedPositions.forEach(e=>{e.parentElement.removeChild(e)}),this.renderedPositions.clear(),this.renderPositions()}removePosition(e){let n=this.renderedPositions.get(e);!n||(n.parentElement.removeChild(n),this.renderedPositions.delete(e),this.renderWinner(),this.highlightLastMove())}renderPositions(){this.board.positions.forEach(e=>{if(this.renderedPositions.get(e))return;let n=re(e,this.cellUISize,this.container);this.renderedPositions.set(e,n)}),this.renderWinner(),this.highlightLastMove()}renderWinner(){Array.from(this.container.querySelectorAll(".winner")).forEach(n=>{n.classList.remove("winner")});const e=this.board.getWinner();e&&e.sequence.forEach(([n,i])=>{const r=this.board.getPosition(n,i);this.renderedPositions.get(r).classList.add("winner")})}highlightLastMove(){Array.from(this.container.querySelectorAll(".last-move")).forEach(n=>n.classList.remove("last-move"));const e=this.board.getLastPlayedPosition();e&&this.renderedPositions.get(e).classList.add("last-move")}}function re(t,e,n){let i=document.createElement("div");return i.className="symbol",i.style.width=e-1+"px",i.style.height=e-1+"px",i.style.left=1+t.x*e+"px",i.style.top=1+t.y*e+"px",i.style.fontSize=e+"px",i.style.lineHeight=e+"px",i.innerText=t.symbol,n.appendChild(i),i}var H=function(e){se(e);var n=oe(e);return e.on=n.on,e.off=n.off,e.fire=n.fire,e};function oe(t){var e=Object.create(null);return{on:function(n,i,r){if(typeof i!="function")throw new Error("callback is expected to be a function");var o=e[n];return o||(o=e[n]=[]),o.push({callback:i,ctx:r}),t},off:function(n,i){var r=typeof n=="undefined";if(r)return e=Object.create(null),t;if(e[n]){var o=typeof i!="function";if(o)delete e[n];else for(var s=e[n],h=0;h<s.length;++h)s[h].callback===i&&s.splice(h,1)}return t},fire:function(n){var i=e[n];if(!i)return t;var r;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var s=i[o];s.callback.apply(s.ctx,r)}return t}}}function se(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}function ae(t){return navigator.clipboard?navigator.clipboard.writeText(t):le(t)}function le(t){let e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();let n=!1;try{n=document.execCommand("copy")}catch{n=!1}return document.body.removeChild(e),n?Promise.resolve():Promise.reject(new Error("copy command was unsuccessful"))}function he(t,e,n){t.querySelector("#clear").addEventListener("click",f),t.querySelector("#copy").addEventListener("click",y),t.querySelector("#hide-info").addEventListener("click",o),t.getElementById("in-a-row").value=e.winLength,t.getElementById("board-width").value=e.width,t.getElementById("board-height").value=e.height,Array.from(t.querySelectorAll(".auto-size")).forEach(a=>{ce(a)}),g(),e.on("change",g);let i=H({});t.getElementById("board-width").addEventListener("change",h),t.getElementById("board-height").addEventListener("change",d),t.getElementById("in-a-row").addEventListener("change",u);let r=L.instance().get("ui")===0;return s(),i;function o(a){r=!r,L.instance().set("ui",r?0:1),s()}function s(){t.querySelector("#hide-info").innerText=r?"Show info":"Hide info",t.querySelector(".info").style.display=r?"none":"block"}function h(a){let c=parseInt(a.target.value,10);c>2&&i.fire("resize",c,e.height)}function d(a){let c=parseInt(a.target.value,10);c>2&&i.fire("resize",e.width,c)}function u(a){let c=parseInt(a.target.value,10);c>2&&i.fire("win-condition-change",c)}function f(a){a.preventDefault(),e.clear(),n.focus()}function y(a){a.preventDefault(),ae(window.location.href).then(()=>{T(t.querySelector("#copy"),"Copied!")}).catch(()=>{T(t.querySelector("#copy"),"Failed to copy")})}function g(){t.getElementById("next-move").innerText=e.getNextMoveSymbol()}}function T(t,e){const n=t.innerText;t.innerText=e,setTimeout(()=>{t.innerText=n},500)}function ce(t){let e=document.createElement("span");e.style.visibility="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.width="auto",e.style.height="auto",e.style.whiteSpace="nowrap";let n=window.getComputedStyle(t);e.style.fontFamily=n.fontFamily,e.style.fontSize=n.fontSize,document.body.appendChild(e),t.addEventListener("change",i),t.addEventListener("keydown",i),t.addEventListener("keyup",i),i({target:t});function i(r){e.innerText=r.target.value,t.style.width=e.offsetWidth+"px"}}class de{constructor(e,n,i){this.x=e,this.y=n,this.symbol=i,this.lDiagonalChecked=!1,this.rDiagonalChecked=!1,this.horizontalChecked=!1,this.verticalChecked=!1}clean(){this.lDiagonalChecked=!1,this.rDiagonalChecked=!1,this.horizontalChecked=!1,this.verticalChecked=!1}}class ue{constructor(e,n,i=5,r="XO"){this.width=e,this.height=n,this.winLength=i,this.positions=[],this.lookup=Object.create(null),this.playerSymbols=[...r],this.currentPlayer=0,H(this)}resize(e,n){this.clear(),this.width=e,this.height=n}setWinCondition(e){this.winLength=e,this.fire("winLengthChanged")}play(e,n){const i=this.getPosition(e,n);i&&i===this.getLastPlayedPosition()?this.undoLastMove():this.placeSymbol(e,n)}placeSymbol(e,n,i){if(e<0||e>=this.width||n<0||n>=this.height)throw new Error(`Invalid position ${e}, ${n}`);if(this.getPosition(e,n))return!1;i||(i=this.playerSymbols[this.currentPlayer]);const r=new de(e,n,i);let o=this.lookup[n];if(o||(this.lookup[n]=o={}),o[e])throw new Error(`Position ${e}, ${n} is already occupied`);return o[e]=r,this.positions.push(r),this.currentPlayer=this.positions.length%this.playerSymbols.length,this.fire("play"),this.fire("change"),!0}getLastPlayedPosition(){return this.positions.length===0?null:this.positions[this.positions.length-1]}undoLastMove(){let e=this.getLastPlayedPosition();if(!e)return;let{x:n,y:i}=e,r=this.lookup[i];delete r[n],this.positions.pop(),this.currentPlayer=this.positions.length%this.playerSymbols.length,this.fire("remove",e),this.fire("change")}clear(){this.positions=[],this.lookup=Object.create(null),this.currentPlayer=0,this.fire("clear"),this.fire("change")}getNextMoveSymbol(){return this.playerSymbols[this.currentPlayer]}getPosition(e,n){let i=this.lookup[n];if(!!i)return i[e]}getWinner(){this.positions.forEach(e=>e.clean());for(let e of this.positions){let n=S(E(e,this,-1,0,1,0,"horizontalChecked"),this.winLength)||S(E(e,this,0,-1,0,1,"verticalChecked"),this.winLength)||S(E(e,this,-1,-1,1,1,"lDiagonalChecked"),this.winLength)||S(E(e,this,-1,1,1,-1,"rDiagonalChecked"),this.winLength);if(n)return{symbol:this.getPosition(n[0][0],n[0][1]).symbol,sequence:n}}}}function E(t,e,n,i,r,o,s){if(t[s])return;let h=t.x,d=t.y,u=e.getPosition(h+n,d+i);for(t[s]=!0;u&&u.symbol===t.symbol;)h+=n,d+=i,u[s]=!0,u=e.getPosition(h+n,d+i);let f=t.x,y=t.y,g=e.getPosition(t.x+r,t.y+o);for(;g&&g.symbol===t.symbol;)f+=r,y+=o,g[s]=!0,g=e.getPosition(f+r,y+o);return{minLeft:h,minTop:d,maxRight:f,maxBottom:y,dx:r,dy:o}}function S(t,e){if(!t)return;let{minLeft:n,minTop:i,maxRight:r,maxBottom:o,dx:s,dy:h}=t,d=[],u=n,f=i;for(;u!=r||f!=o;)d.push([u,f]),u+=s,f+=h;if((n!==r||i!==o)&&d.push([r,o]),d.length>=e)return d}const P=512+256;function fe(t){const e=new ue(t.get("w"),t.get("h"),t.get("l"),t.get("s"));return ge(pe(t),e.width).forEach(i),e.on("change",ve(n)),e;function n(){let r=ye(e.positions,e.width);t.set("m",r.mainQuery),r.overflow?window.location.hash="#o="+r.overflow:window.location.hash=""}function i(r){try{e.play(r[0],r[1])}catch(o){console.error(o.message)}}}function ge(t,e){if(t==="")return[];try{return(""+t).split("_").map(n=>{let i=Number.parseInt(n,36),r=Math.floor(i/e),o=i%e;return[r,o]})}catch(n){return console.error("Failed to decode sequence",n),[]}}function ye(t,e){let n=t.map(r=>(r.x*e+r.y).toString(36)).join("_"),i="";return n.length>P&&(i=n.slice(P),n=n.slice(0,P)),{mainQuery:n,overflow:i}}function pe(t){let e=t.get("m");return window.location.hash.indexOf("o=")>0&&(e+=window.location.hash.slice(window.location.hash.indexOf("o=")+2)),e}function ve(t){let e;return function(){clearTimeout(e),e=setTimeout(t,10)}}const me={w:15,h:15,s:"XO",l:5,m:""},M=L.instance(me,{useSearch:!0});let m=fe(M),x=new A(document.getElementById("board"),m),q=he(document,m,x);q.on("resize",we);q.on("win-condition-change",Ce);window.board=m;function we(t,e){x.dispose(),m.resize(t,e),M.set({w:t,h:e}),x=new A(document.getElementById("board"),m)}function Ce(t){M.set({l:t}),m.setWinCondition(t)}
//# sourceMappingURL=index.1cc9cb18.js.map
